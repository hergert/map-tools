<!doctype html>
<html lang="en" ng-app="app">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="benchmark/style.css">
</head>
<body>

<script src="benchmark/mock.js"></script>
<script src="../node_modules/lodash/index.js"></script>
<script src="../node_modules/platform/platform.js"></script>
<script src="../node_modules/benchmark/benchmark.js"></script>



<script src="../dist/gmplus.js"></script>
<script src="../node_modules/gmaps/gmaps.js"></script>

<script src="../node_modules/angular/angular.js"></script>


<script>

  function getHz(bench) {
    return 1 / (bench.stats.mean + bench.stats.moe);
  }

  function percentage(number) {
    var result = number < 1 ? number.toFixed(2) : Math.round(number)
    return result;
  }

  var app = angular.module('app', []);

  app.controller('resultsCtrl', function ($scope) {

    $scope.results = [{title: 'addMarker()'}];

    var gmplusMap = new GMP({
      async: false,
      id: 'gmplus',
      lat: 41.3833,
      lng: 2.1833,
      zoom: 8,
      scrollwheel: false,
      navigationControl: false,
      mapTypeControl: false,
      scaleControl: false,
      draggable: false
    });

    var gmapsMap = new GMaps({
      div: '#gmaps',
      lat: 41.3833,
      lng: 2.1833,
      zoom: 8,
      scrollwheel: false,
      navigationControl: false,
      mapTypeControl: false,
      scaleControl: false,
      draggable: false
    });



    //var func = function(){};
    //var regex = /function/i;

    function init() {
      suite = new Benchmark.Suite;


    suite.add('GMaps.js', function () {
        // /function/i.test(Object.prototype.toString.call(func))
        gmapsMap.addMarker({
          lat: 41.3833,
          lng: 2.1833,
          title: 'Barcelona'
        });
      })
      .add('gmplus.js', function () {
        //typeof func === 'function'
        gmplusMap.addMarker({
          lat: 41.3833,
          lng: 2.1833,
          title: 'Barcelona'
        });
      })
        // add listeners
        .on('cycle', function (event) {
          //target = String(event.target);
          //$scope.results[0].target = String(event.target);
          //$scope.$apply();
        })
        .on('complete', function () {
          benches = this.filter('successful');
          fastest = this.filter('fastest')[0];
          slowest = this.filter('slowest')[0];
          var fastestHz = getHz(fastest);
          var slowestHz = getHz(slowest);

        var item;
        _.each(benches, function(bench,b) {

            var percent = (1 - (slowestHz / fastestHz)) * 100;

            var type = (fastest._timerId === bench._timerId) ? '% fastest' : '% slowest';

            item = {
              name: bench.name,
              data: percentage(percent) + type
            };

            $scope.results.push(item)

          });

          $scope.$apply();
        })
        // run async
        .run({'async': true});
    }

    init();

  });


</script>


<div class="results" ng-controller="resultsCtrl">
  <table class="table">
    <tr>
      <td>Name</td>
      <td>Results</td>
    </tr>
    <tr ng-repeat="result in results">
      <td>{{result.name}}</td>
      <td>{{result.data}}</td>
    <tr>
  </table>
</div>

<div id="gmplus"></div>
<div id="gmaps"></div>
</body>
</html>
